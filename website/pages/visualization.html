<script src="https://unpkg.com/vtk.js@29.3.0/vtk.js"></script>
<body id="app"></body>
<script type="module">
    import { createApp, ref } from "vue"
    import { VisualizationPreview } from "components/visualization_preview.js"
    import { VisualizationContent } from "components/visualization_content.js"
    import { VisualizationWizard } from "components/visualization_wizard.js"
    import { SharedHeader } from "components/shared_header.js"
    import { SharedFooter } from "components/shared_footer.js"
    import { Tag } from "components/tag.js"

    createApp(
    {
        components:
        {
            "visualization-preview": VisualizationPreview,
            "visualization-content": VisualizationContent,
            "visualization-wizard": VisualizationWizard,
            "shared-header": SharedHeader,
            "shared-footer": SharedFooter,
            "tag": Tag
        },
        setup()
        {
            let visualization = ref(
            {
                name: "",
                date: "",
                tags: [],
                images: [],
                resources: [],
                datasets: [],
                templates: [],
                description: ""
            });

            function on_visualization_tag_click(tag)
            {
                window.location = "/browser?tags=" + encodeURIComponent(tag.name + "+" + tag.type + "+" + tag.abbreviation);
            }

            return {
                visualization,
                on_visualization_tag_click
            }
        },
        async mounted()
        {
            const parameters = new URLSearchParams(window.location.search);

            const visualization_name = parameters.get("name");
            const visualization_request = 
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(
                {
                    visualization_name
                })
            }

            const response = await fetch("/api/fetch_visualization", visualization_request);

            if(response.ok)
            {
                this.visualization = await response.json();    
            }
        },
        template:
        `
        <header>
            <shared-header></shared-header>
        </header>
        <main>
            <visualization-preview class="container my-4" :visualization="visualization"></visualization-preview>
            <div class="container mb-4">
                <h1 class="mb-2">{{ visualization.name }}</h1>
                <div class="d-flex">
                    <tag v-for="tag in visualization.tags" :tag="tag" class="me-1" @on_tag_click="on_visualization_tag_click"></tag>
                </div>
            </div>
            <div class="container mb-4 visualization-description" v-html="visualization.description"></div>
            <div class="w-100 py-4 bg-body-tertiary">
                <div class="container">
                    <visualization-wizard :visualization="visualization" class="mb-4"></visualization-wizard>
                    <visualization-content :visualization="visualization"></visualization-content>
                </div>
            </div>
        </main>
        <footer>
            <shared-footer class="container py-5"></shared-footer>
        </footer>
        `
    }).mount("#app");
</script>