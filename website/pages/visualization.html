<script src="https://unpkg.com/vtk.js@29.3.0/vtk.js"></script>
<body id="app"></body>
<script type="module">
    import { createApp, ref } from "vue"
    import { VisualizationPreview } from "components/visualization_preview.js"
    import { VisualizationContent } from "components/visualization_content.js"
    import { VisualizationWizard } from "components/visualization_wizard.js"
    import { SharedHeader } from "components/shared_header.js"
    import { SharedFooter } from "components/shared_footer.js"
    import { Outline } from "components/outline.js"
    import { Tag } from "components/tag.js"

    createApp(
    {
        components:
        {
            "visualization-preview": VisualizationPreview,
            "visualization-content": VisualizationContent,
            "visualization-wizard": VisualizationWizard,
            "shared-header": SharedHeader,
            "shared-footer": SharedFooter,
            "outline": Outline,
            "tag": Tag
        },
        setup()
        {
            let content = ref(null);
            let visualization = ref(
            {
                name: "",
                date: "",
                tags: [],
                images: [],
                resources: [],
                datasets: [],
                templates: [],
                scene: "",
                description: ""
            });

            function on_visualization_tag_click(tag)
            {
                window.location = "/browser?tags=" + encodeURIComponent(tag.name + "+" + tag.type + "+" + tag.abbreviation);
            }

            return {
                content,
                visualization,
                on_visualization_tag_click
            }
        },
        async mounted()
        {
            const parameters = new URLSearchParams(window.location.search);

            const visualization_name = parameters.get("name");
            const visualization_request = 
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(
                {
                    visualization_name
                })
            }

            const response = await fetch("/api/fetch_visualization", visualization_request);

            if(response.ok)
            {
                this.visualization = await response.json();    
            }
        },
        template:
        `
        <header class="sticky-top">
            <shared-header>
                <h5 class="pt-3 pb-1">On this page</h5>
                <outline :target="content"></outline>
            </shared-header>
        </header>
        <main>
            <div class="container d-flex">
                <div ref="content" class="me-lg-4 flex-fill">
                    <visualization-preview class="my-4" :visualization="visualization"></visualization-preview>
                    <div class="mb-4">
                        <h1 class="mb-2" style="font-size: 3rem">{{ visualization.name }}</h1>
                        <div class="d-flex">
                            <tag v-for="tag in visualization.tags" :tag="tag" class="me-1" @on_tag_click="on_visualization_tag_click"></tag>
                        </div>
                    </div>
                    <div class="mb-4 visualization-description" v-html="visualization.description"></div>
                    <!--<div class="mb-4" id="resources" outline_label="Resources" outline_indent="0" markdown="1">
                        <h3 class="mb-2">Resources</h3>
                        <visualization-content :visualization="visualization"></visualization-content>
                    </div>-->
                    <!--<visualization-wizard :visualization="visualization" class="mb-4"></visualization-wizard>-->
                </div>
                <div class="flex-shrink-0 d-none d-lg-block" style="width: 250px;">
                    <div class="sticky-top" style="top: 100px; z-index: 0;">
                        <h5 class="about-content pt-3 pb-1">Example</h5>
                        <div class="btn btn-primary">
                            <div class="d-flex align-items-center">
                                <div>Download</div>
                                <img class="ms-2" src="symbols/download.svg">
                            </div>
                        </div>
                        <h5 class="about-content pt-3 pb-1">On this page</h5>
                        <outline :target="content"></outline>
                    </div>
                </div>
            </div>
        </main>
        <footer class="bg-body-tertiary">
            <shared-footer></shared-footer>
        </footer>
        `
    }).mount("#app");
</script>